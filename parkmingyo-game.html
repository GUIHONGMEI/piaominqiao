<!DOCTYPE html>
<html>
<head>
    <title>ë°•ë¯¼êµì˜ ë¬´í•œí•œ ì•Œê³¼ ì„¸ê³„</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: linear-gradient(to bottom, #87CEEB, #98FB98);
            font-family: Arial, sans-serif;
        }
        canvas {
            border: 3px solid #333;
            background: linear-gradient(to bottom, #87CEEB 0%, #98FB98 70%, #8B4513 100%);
            display: block;
            margin: 0 auto;
        }
        .game-info {
            text-align: center;
            margin: 10px;
            font-size: 18px;
            color: #333;
        }
    </style>
</head>
<body>
    <div class="game-info">
        <h1>ğŸ† ë°•ë¯¼êµì˜ ë¬´í•œí•œ ì•Œê³¼ ì„¸ê³„ ğŸ†</h1>
                 <p>ë°©í–¥í‚¤: ì´ë™ | ìŠ¤í˜ì´ìŠ¤: ì í”„ | A: ì´ì•Œ ë°œì‚¬ | X: íŠ¹ìˆ˜ëŠ¥ë ¥ | S: ìƒì  | B: ì´ì•Œ êµ¬ë§¤ | R: ë¶€í™œ | P: ì°¨ì›ë¬¸ | N: ë‹¤ìŒ ì§€ì—­ ì´ë™ | ì ê³¼ ë¶€ë”ªíˆë©´ í”¼ê°€ ë‹¬ì•„ ì—†ì–´ì ¸ìš”!</p>
    </div>
    <canvas id="gameCanvas" width="1000" height="600"></canvas>

    <script>
        // ê²Œì„ ìº”ë²„ìŠ¤ ì„¤ì •
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        
                 // ê²Œì„ ìƒíƒœ
         let gameState = {
             score: 0,
             coins: 0,
             level: 1,
             world: 'ground', // ground, ice, sky, fire, water, wind, dark, light, time
             shopOpen: false,
             shopInside: false,
             blackHoleActive: false,
             blackHoleX: 0,
             blackHoleY: 0,
             blackHoleTime: 0,
             companionBird: null,
             characterType: 'default', // default, fire, ice, wind
             gameOver: false,
             playerDead: false,
             caveHealth: 100, // ë™êµ´ ì²´ë ¥
             portalActive: false, // ì°¨ì›ë¬¸ í™œì„±í™” ìƒíƒœ
             portalX: 0,
             portalY: 0,
             monstersKilled: 0, // ì£½ì¸ ê´´ë¬¼ ìˆ˜
             canMoveToNextArea: false, // ë‹¤ìŒ ì§€ì—­ ì´ë™ ê°€ëŠ¥ ì—¬ë¶€
             currentArea: 1, // í˜„ì¬ ì§€ì—­ ë²ˆí˜¸
             inventoryOpen: false, // ì¸ë²¤í† ë¦¬ ì—´ë¦¼ ìƒíƒœ
             bulletInventory: {
                 normal: { count: 50, maxCount: 100, name: 'ì¼ë°˜ ì´ì•Œ', color: '#FFD700', damage: 1 },
                 fire: { count: 0, maxCount: 50, name: 'ë¶ˆ ì´ì•Œ', color: '#FF4500', damage: 2 },
                 ice: { count: 0, maxCount: 50, name: 'ì–¼ìŒ ì´ì•Œ', color: '#87CEEB', damage: 1.5 },
                 lightning: { count: 0, maxCount: 30, name: 'ë²ˆê°œ ì´ì•Œ', color: '#FFFF00', damage: 3 },
                 poison: { count: 0, maxCount: 40, name: 'ë… ì´ì•Œ', color: '#32CD32', damage: 1.8 }
             },
             selectedBulletType: 'normal' // í˜„ì¬ ì„ íƒëœ ì´ì•Œ íƒ€ì…
         };

        // íŠ¹ë³„í•œ ì•Œ (ê²€ì€ ì•Œ)
        let specialEgg = createSpecialEgg();

        // ë°•ë¯¼êµ ìºë¦­í„°
        const player = {
            x: 100,
            y: 450,
            width: 40,
            height: 60,
            velocityX: 0,
            velocityY: 0,
            speed: 5,
            jumpPower: 25, // ì í”„ë ¥ ì¦ê°€
            isJumping: false,
            health: 100,
            maxHealth: 100,
            ammo: 20,
            maxAmmo: 20,
            isInvincible: false,
            invincibleTime: 0
        };

        // ì ë“¤ ë°°ì—´
        const enemies = [];
        const bullets = [];
        const coins = [];
        const eggs = [];
        const guns = [];
        const ammoBoxes = [];
        const clouds = [];
        const ladders = createLadders();

        // í‚¤ë³´ë“œ ì…ë ¥
        const keys = {};

        // í‚¤ë³´ë“œ ì´ë²¤íŠ¸
        document.addEventListener('keydown', (e) => {
            keys[e.key] = true;
            
            // ì´ì•Œ ë°œì‚¬
            if (e.key === 'a' || e.key === 'A') {
                fireBullet();
            }
            
            // íŠ¹ìˆ˜ëŠ¥ë ¥
            if (e.key === 'x' || e.key === 'X') {
                useSpecialAbility();
            }
            
            // ìƒì  ì—´ê¸°/ë‹«ê¸°
            if (e.key === 's' || e.key === 'S') {
                if (gameState.shopInside) {
                    // ìƒì  ì•ˆì—ì„œ ë‚˜ê°€ê¸°
                    gameState.shopInside = false;
                    gameState.shopOpen = false;
                    player.x = 100;
                    player.y = 450;
                } else if (checkPlayerInShop()) {
                    // ìƒì  ì•ì—ì„œ ìƒì  ì•ˆìœ¼ë¡œ ë“¤ì–´ê°€ê¸°
                    gameState.shopInside = true;
                    gameState.shopOpen = true;
                    player.x = 400;
                    player.y = 300;
                } else {
                    // ìƒì  UI ì—´ê¸°/ë‹«ê¸°
                    gameState.shopOpen = !gameState.shopOpen;
                }
            }
            
            // ìƒì ì—ì„œ ì´ì•Œ êµ¬ë§¤
            if (e.key === 'b' || e.key === 'B') {
                if (gameState.shopOpen) {
                    buyAmmo();
                } else if (gameState.companionBird) {
                    // ë¸”ë™í™€ ì†Œí™˜ (Bí‚¤)
                    createBlackHole();
                }
            }
            
                         // ìºë¦­í„° ë³€ê²½
             if (gameState.shopOpen) {
                 if (e.key === '1') {
                     changeCharacter('fire');
                 } else if (e.key === '2') {
                     changeCharacter('ice');
                 } else if (e.key === '3') {
                     changeCharacter('wind');
                 }
             }
             
             // ë¶€í™œ (Rí‚¤)
             if (e.key === 'r' || e.key === 'R') {
                 if (gameState.playerDead) {
                     respawnPlayer();
                 }
             }
             
             // ì°¨ì›ë¬¸ ì§„ì… (Pí‚¤)
             if (e.key === 'p' || e.key === 'P') {
                 if (gameState.portalActive && checkPlayerInPortal()) {
                     enterPortal();
                 }
             }
             
             // ë‹¤ìŒ ì§€ì—­ ì´ë™ (Ní‚¤)
             if (e.key === 'n' || e.key === 'N') {
                 if (gameState.canMoveToNextArea) {
                     moveToNextArea();
                 }
             }
             
             // ì¸ë²¤í† ë¦¬ ì—´ê¸°/ë‹«ê¸° (Ií‚¤)
             if (e.key === 'i' || e.key === 'I') {
                 gameState.inventoryOpen = !gameState.inventoryOpen;
             }
             
             // ì´ì•Œ íƒ€ì… ì„ íƒ (ì¸ë²¤í† ë¦¬ì—ì„œ)
             if (gameState.inventoryOpen) {
                 if (e.key === '1') {
                     selectBulletType('normal');
                 } else if (e.key === '2') {
                     selectBulletType('fire');
                 } else if (e.key === '3') {
                     selectBulletType('ice');
                 } else if (e.key === '4') {
                     selectBulletType('lightning');
                 } else if (e.key === '5') {
                     selectBulletType('poison');
                 }
             }
        });

        document.addEventListener('keyup', (e) => {
            keys[e.key] = false;
        });

        // ì´ì•Œ ë°œì‚¬ í•¨ìˆ˜
        function fireBullet() {
            const selectedBullet = gameState.bulletInventory[gameState.selectedBulletType];
            if (selectedBullet && selectedBullet.count > 0) {
                bullets.push({
                    x: player.x + player.width,
                    y: player.y + player.height / 2,
                    width: 10,
                    height: 5,
                    speed: 10,
                    color: selectedBullet.color,
                    type: gameState.selectedBulletType,
                    damage: selectedBullet.damage
                });
                selectedBullet.count--;
                
                // ì´ì†Œë¦¬ íš¨ê³¼ (ë¹„í”„ìŒ)
                playGunSound();
            }
        }

        // ì´ì†Œë¦¬ ì¬ìƒ í•¨ìˆ˜
        function playGunSound() {
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
            oscillator.frequency.exponentialRampToValueAtTime(400, audioContext.currentTime + 0.1);
            
            gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
            
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.1);
        }

        // ìƒì ì—ì„œ ì´ì•Œ êµ¬ë§¤ í•¨ìˆ˜
        function buyAmmo() {
            if (gameState.coins >= 1) {
                gameState.coins -= 1;
                const selectedBullet = gameState.bulletInventory[gameState.selectedBulletType];
                if (selectedBullet) {
                    selectedBullet.count = Math.min(selectedBullet.maxCount, selectedBullet.count + 20);
                }
            }
        }
        
        // ì´ì•Œ íƒ€ì… ì„ íƒ í•¨ìˆ˜
        function selectBulletType(type) {
            if (gameState.bulletInventory[type]) {
                gameState.selectedBulletType = type;
                console.log(`ì„ íƒëœ ì´ì•Œ: ${gameState.bulletInventory[type].name}`);
            }
        }

        // ìºë¦­í„° ë³€ê²½ í•¨ìˆ˜
        function changeCharacter(type) {
            if (gameState.coins >= 5) {
                gameState.coins -= 5;
                gameState.characterType = type;
                
                // ìºë¦­í„°ë³„ íŠ¹ë³„ ëŠ¥ë ¥
                switch(type) {
                    case 'fire':
                        player.maxHealth = 120;
                        player.health = 120;
                        break;
                    case 'ice':
                        player.maxAmmo = 30;
                        player.ammo = 30;
                        break;
                    case 'wind':
                        player.jumpPower = 20;
                        break;
                }
            }
        }

        // êµ¬ë¦„ ìƒì„± í•¨ìˆ˜
        function createClouds() {
            const cloudTypes = [
                { name: 'fluffy', size: 1.2, parts: 5, color: '#FFFFFF' },
                { name: 'wispy', size: 0.8, parts: 3, color: '#F0F8FF' },
                { name: 'puffy', size: 1.0, parts: 4, color: '#F5F5F5' },
                { name: 'stormy', size: 1.1, parts: 6, color: '#E6E6FA' },
                { name: 'cotton', size: 0.9, parts: 4, color: '#FAFAFA' }
            ];
            
            for (let i = 0; i < 5; i++) {
                const cloudType = cloudTypes[i % cloudTypes.length];
                clouds.push({
                    x: 100 + i * 200,
                    y: 50 + i * 20,
                    width: 90 * cloudType.size,
                    height: 30 * cloudType.size,
                    canStand: true,
                    type: cloudType.name,
                    color: cloudType.color,
                    parts: cloudType.parts,
                    baseSize: cloudType.size
                });
            }
        }

        // ì‚¬ë‹¤ë¦¬ ìƒì„± í•¨ìˆ˜
        function createLadders() {
            return [
                // ë™êµ´ ì• ê¸´ ì‚¬ë‹¤ë¦¬ (ë™êµ´ ìœ„ë¡œ ê°€ëŠ” ì‚¬ë‹¤ë¦¬)
                {
                    x: canvas.width - 120,
                    y: 450,
                    width: 20,
                    height: 150,
                    color: '#8B4513'
                },
                // ë™êµ´ ìœ„ë¡œ ê°€ëŠ” ì‚¬ë‹¤ë¦¬
                {
                    x: canvas.width - 50,
                    y: 380,
                    width: 20,
                    height: 80,
                    color: '#8B4513'
                },
                // ì²« ë²ˆì§¸ êµ¬ë¦„ìœ¼ë¡œ ê°€ëŠ” ì‚¬ë‹¤ë¦¬
                {
                    x: 150,
                    y: 450,
                    width: 20,
                    height: 120,
                    color: '#8B4513'
                },
                // êµ¬ë¦„ë“¤ ì‚¬ì´ì˜ ì‚¬ë‹¤ë¦¬ë“¤
                {
                    x: 350,
                    y: 450,
                    width: 20,
                    height: 100,
                    color: '#8B4513'
                },
                {
                    x: 550,
                    y: 450,
                    width: 20,
                    height: 80,
                    color: '#8B4513'
                },
                {
                    x: 750,
                    y: 450,
                    width: 20,
                    height: 60,
                    color: '#8B4513'
                }
            ];
        }

        // íŠ¹ë³„í•œ ì•Œ ìƒì„± í•¨ìˆ˜ (ê²€ì€ ì•Œ)
        function createSpecialEgg() {
            return {
                x: 100 + 3 * 200 + 30, // 4ë²ˆì§¸ êµ¬ë¦„ ìœ„ì¹˜
                y: 50 + 3 * 20 - 40,
                width: 30,
                height: 40,
                type: 'special',
                color: '#000000', // ê²€ì€ìƒ‰
                collected: false
            };
        }

        // ë¸”ë™í™€ ìƒì„± í•¨ìˆ˜
        function createBlackHole() {
            gameState.blackHoleActive = true;
            gameState.blackHoleX = player.x + 50;
            gameState.blackHoleY = player.y + 30;
            gameState.blackHoleTime = 120; // 2ì´ˆê°„ ì§€ì†
        }

        // ë”°ë¼ì˜¤ëŠ” ìƒˆ ìƒì„± í•¨ìˆ˜
        function createCompanionBird() {
            gameState.companionBird = {
                x: player.x - 20,
                y: player.y - 10,
                width: 20,
                height: 15,
                color: '#000000',
                followDistance: 20 // 2cm ê°„ê²©
            };
        }

                 // ìƒì  ì•ì— ìˆëŠ”ì§€ í™•ì¸í•˜ëŠ” í•¨ìˆ˜
         function checkPlayerInShop() {
             return player.x > 50 && player.x < 130 && 
                    player.y > 400 && player.y < 500;
         }
         
         // í”Œë ˆì´ì–´ ë¶€í™œ í•¨ìˆ˜
         function respawnPlayer() {
             player.health = player.maxHealth;
             player.x = 100;
             player.y = 450;
             player.velocityY = 0;
             player.isJumping = false;
             player.isInvincible = false;
             player.invincibleTime = 0;
             gameState.playerDead = false;
             gameState.gameOver = false;
         }
         
         // ì°¨ì›ë¬¸ ì•ì— ìˆëŠ”ì§€ í™•ì¸í•˜ëŠ” í•¨ìˆ˜
         function checkPlayerInPortal() {
             return player.x > gameState.portalX - 30 && player.x < gameState.portalX + 60 && 
                    player.y > gameState.portalY - 20 && player.y < gameState.portalY + 100;
         }
         
         // ì°¨ì›ë¬¸ ì§„ì… í•¨ìˆ˜
         function enterPortal() {
             // ìƒˆë¡œìš´ ì„¸ê³„ë¡œ ì´ë™
             const worlds = ['ice', 'fire', 'water', 'wind', 'dark', 'light', 'time'];
             const currentIndex = worlds.indexOf(gameState.world);
             const nextIndex = (currentIndex + 1) % worlds.length;
             gameState.world = worlds[nextIndex];
             
             // í”Œë ˆì´ì–´ ìœ„ì¹˜ ë¦¬ì…‹
             player.x = 100;
             player.y = 450;
             
             // ë™êµ´ ì²´ë ¥ íšŒë³µ
             gameState.caveHealth = 100;
             gameState.portalActive = false;
             
             // ì ìˆ˜ ë³´ë„ˆìŠ¤
             gameState.score += 500;
             gameState.coins += 20;
             
             console.log(`ìƒˆë¡œìš´ ì„¸ê³„ë¡œ ì´ë™: ${gameState.world}`);
         }
         
         // ë‹¤ìŒ ì§€ì—­ ì´ë™ í•¨ìˆ˜
         function moveToNextArea() {
             gameState.currentArea++;
             gameState.monstersKilled = 0;
             gameState.canMoveToNextArea = false;
             
             // í”Œë ˆì´ì–´ ìœ„ì¹˜ ë¦¬ì…‹
             player.x = 100;
             player.y = 450;
             
             // ëª¨ë“  ì  ì œê±°
             enemies.length = 0;
             
             // ì ìˆ˜ ë³´ë„ˆìŠ¤
             gameState.score += 1000;
             gameState.coins += 50;
             
             // ë ˆë²¨ ì—…
             gameState.level++;
             
             console.log(`ë‹¤ìŒ ì§€ì—­ìœ¼ë¡œ ì´ë™: ì§€ì—­ ${gameState.currentArea}`);
         }

        // íŠ¹ìˆ˜ëŠ¥ë ¥ ì‚¬ìš©
        function useSpecialAbility() {
            // í˜„ì¬ ì„¸ê³„ì— ë”°ë¥¸ íŠ¹ìˆ˜ëŠ¥ë ¥
            switch(gameState.world) {
                case 'ice':
                    // ì–¼ìŒ ëŠ¥ë ¥: ì ë“¤ì„ ì–¼ë ¤ë²„ë¦¬ê¸°
                    enemies.forEach(enemy => {
                        enemy.frozen = true;
                        enemy.frozenTime = 100;
                    });
                    break;
                case 'fire':
                    // ë¶ˆ ëŠ¥ë ¥: ê°•ë ¥í•œ í­ë°œ
                    enemies.forEach(enemy => {
                        enemy.health -= 20;
                    });
                    break;
                case 'wind':
                    // ë°”ëŒ ëŠ¥ë ¥: ë†’ì´ ì í”„
                    player.velocityY = -25;
                    break;
            }
        }

        // ì  ìƒì„± í•¨ìˆ˜
        function createEnemy() {
            const types = ['mini', 'medium', 'boss'];
            const type = types[Math.floor(Math.random() * types.length)];
            
            let enemy = {
                x: canvas.width,
                y: 450,
                width: 40,
                height: 50,
                type: type,
                health: 0,
                speed: 0,
                attack: 0,
                coinValue: 0,
                color: '#FF0000',
                frozen: false,
                frozenTime: 0
            };

            switch(type) {
                case 'mini':
                    enemy.health = 5;
                    enemy.speed = 4;
                    enemy.attack = 1;
                    enemy.coinValue = 1;
                    enemy.color = '#FF6B6B';
                    break;
                case 'medium':
                    enemy.health = 15;
                    enemy.speed = 2;
                    enemy.attack = 5;
                    enemy.coinValue = 3;
                    enemy.color = '#FF8C00';
                    break;
                case 'boss':
                    enemy.health = 50;
                    enemy.speed = 1;
                    enemy.attack = 10;
                    enemy.coinValue = 5;
                    enemy.color = '#8B0000';
                    enemy.width = 60;
                    enemy.height = 80;
                    break;
            }

            enemies.push(enemy);
        }

        // ì•Œ ìƒì„± í•¨ìˆ˜
        function createEgg() {
            const eggTypes = ['gum', 'ice', 'fire', 'water', 'wind', 'dark', 'light', 'time'];
            const type = eggTypes[Math.floor(Math.random() * eggTypes.length)];
            
            eggs.push({
                x: Math.random() * (canvas.width - 30),
                y: Math.random() * 200 + 50,
                width: 30,
                height: 40,
                type: type,
                color: getEggColor(type),
                collected: false
            });
        }

        // ì´ ìƒì„± í•¨ìˆ˜
        function createGun() {
            guns.push({
                x: Math.random() * (canvas.width - 40),
                y: 450,
                width: 30,
                height: 15,
                color: '#8B4513',
                collected: false
            });
        }

        // ì´ì•Œ ìƒì ìƒì„± í•¨ìˆ˜
        function createAmmoBox() {
            ammoBoxes.push({
                x: Math.random() * (canvas.width - 30),
                y: 450,
                width: 25,
                height: 20,
                ammo: 10,
                color: '#FFD700',
                collected: false
            });
        }

        // ì•Œ ìƒ‰ìƒ í•¨ìˆ˜
        function getEggColor(type) {
            const colors = {
                'gum': '#FFB6C1',
                'ice': '#87CEEB',
                'fire': '#FF4500',
                'water': '#4169E1',
                'wind': '#F0F8FF',
                'dark': '#2F4F4F',
                'light': '#FFFFE0',
                'time': '#DDA0DD'
            };
            return colors[type] || '#FFFFFF';
        }

        // ì¶©ëŒ ê°ì§€ í•¨ìˆ˜
        function checkCollision(rect1, rect2) {
            return rect1.x < rect2.x + rect2.width &&
                   rect1.x + rect1.width > rect2.x &&
                   rect1.y < rect2.y + rect2.height &&
                   rect1.y + rect1.height > rect2.y;
        }

        // ê²Œì„ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updateGame() {
            // í”Œë ˆì´ì–´ ì´ë™
            if (keys['ArrowLeft'] && player.x > 0) {
                player.x -= player.speed;
            }
            if (keys['ArrowRight'] && player.x < canvas.width - player.width) {
                player.x += player.speed;
            }
            if (keys[' '] && !player.isJumping) {
                player.velocityY = -player.jumpPower;
                player.isJumping = true;
            }

            // ì¤‘ë ¥
            player.velocityY += 0.8;
            player.y += player.velocityY;

            // ë°”ë‹¥ ì¶©ëŒ
            if (player.y > 450) {
                player.y = 450;
                player.velocityY = 0;
                player.isJumping = false;
            }
            
            // ë™êµ´ ìœ„ í”Œë«í¼ ì¶©ëŒ
            if (player.x > canvas.width - 100 && player.x < canvas.width && 
                player.y > 360 && player.y < 380 && player.velocityY > 0) {
                player.y = 360;
                player.velocityY = 0;
                player.isJumping = false;
            }

            // êµ¬ë¦„ ì¶©ëŒ ê°ì§€
            clouds.forEach(cloud => {
                if (player.x + player.width > cloud.x && 
                    player.x < cloud.x + cloud.width &&
                    player.y + player.height > cloud.y && 
                    player.y + player.height < cloud.y + cloud.height + 15 && // ì¶©ëŒ ë²”ìœ„ ì¦ê°€
                    player.velocityY > 0) {
                    player.y = cloud.y - player.height;
                    player.velocityY = 0;
                    player.isJumping = false;
                }
            });

            // ì‚¬ë‹¤ë¦¬ ì¶©ëŒ ê°ì§€
            ladders.forEach(ladder => {
                if (player.x + player.width > ladder.x && 
                    player.x < ladder.x + ladder.width &&
                    player.y + player.height > ladder.y && 
                    player.y < ladder.y + ladder.height) {
                    
                    // ì‚¬ë‹¤ë¦¬ ìœ„ë¡œ ì˜¬ë¼ê°€ê¸°
                    if (keys['ArrowUp']) {
                        player.y -= 4; // ì‚¬ë‹¤ë¦¬ ì˜¤ë¥´ê¸° ì†ë„ ì¦ê°€
                        player.velocityY = 0;
                        player.isJumping = false;
                    }
                    // ì‚¬ë‹¤ë¦¬ ì•„ë˜ë¡œ ë‚´ë ¤ê°€ê¸°
                    if (keys['ArrowDown']) {
                        player.y += 4; // ì‚¬ë‹¤ë¦¬ ë‚´ë ¤ê°€ê¸° ì†ë„ ì¦ê°€
                        player.velocityY = 0;
                        player.isJumping = false;
                    }
                }
            });

            // ì´ì•Œ ì—…ë°ì´íŠ¸
            bullets.forEach((bullet, index) => {
                bullet.x += bullet.speed;
                if (bullet.x > canvas.width) {
                    bullets.splice(index, 1);
                }
            });

            // ì  ì—…ë°ì´íŠ¸
            enemies.forEach((enemy, index) => {
                if (!enemy.frozen) {
                    enemy.x -= enemy.speed;
                } else {
                    enemy.frozenTime--;
                    if (enemy.frozenTime <= 0) {
                        enemy.frozen = false;
                    }
                }
                
                // ìƒíƒœ íš¨ê³¼ ì—…ë°ì´íŠ¸
                if (enemy.burning && enemy.burnTime > 0) {
                    enemy.health -= 0.5;
                    enemy.burnTime--;
                    if (enemy.burnTime <= 0) {
                        enemy.burning = false;
                    }
                }
                
                if (enemy.poisoned && enemy.poisonTime > 0) {
                    enemy.health -= 0.3;
                    enemy.poisonTime--;
                    if (enemy.poisonTime <= 0) {
                        enemy.poisoned = false;
                    }
                }

                if (enemy.x + enemy.width < 0) {
                    enemies.splice(index, 1);
                }
            });

            // ì¶©ëŒ ê°ì§€
            // ì´ì•Œê³¼ ì 
            bullets.forEach((bullet, bIndex) => {
                enemies.forEach((enemy, eIndex) => {
                    if (checkCollision(bullet, enemy)) {
                        // ì´ì•Œ íƒ€ì…ì— ë”°ë¥¸ ë°ë¯¸ì§€ ì ìš©
                        const damage = bullet.damage || 1;
                        enemy.health -= damage * 10;
                        bullets.splice(bIndex, 1);
                        
                        // ì´ì•Œ íƒ€ì…ë³„ íŠ¹ìˆ˜ íš¨ê³¼
                        if (bullet.type === 'fire') {
                            // ë¶ˆ ì´ì•Œ: ì§€ì† ë°ë¯¸ì§€
                            enemy.burning = true;
                            enemy.burnTime = 30;
                        } else if (bullet.type === 'ice') {
                            // ì–¼ìŒ ì´ì•Œ: ë¹™ê²° íš¨ê³¼
                            enemy.frozen = true;
                            enemy.frozenTime = 60;
                        } else if (bullet.type === 'lightning') {
                            // ë²ˆê°œ ì´ì•Œ: ì²´ì¸ ë°ë¯¸ì§€
                            enemies.forEach((otherEnemy, otherIndex) => {
                                if (otherIndex !== eIndex && Math.abs(otherEnemy.x - enemy.x) < 100) {
                                    otherEnemy.health -= 5;
                                }
                            });
                        } else if (bullet.type === 'poison') {
                            // ë… ì´ì•Œ: ë… ë°ë¯¸ì§€
                            enemy.poisoned = true;
                            enemy.poisonTime = 45;
                        }
                        
                        if (enemy.health <= 0) {
                            // ì½”ì¸ ìƒì„±
                            coins.push({
                                x: enemy.x,
                                y: enemy.y,
                                width: 20,
                                height: 20,
                                value: enemy.coinValue,
                                collected: false
                            });
                            
                            gameState.score += enemy.coinValue * 10;
                            gameState.monstersKilled++; // ê´´ë¬¼ ì‚¬ëƒ¥ ì¹´ìš´í„° ì¦ê°€
                            enemies.splice(eIndex, 1);
                            
                            // 50ë§ˆë¦¬ ì£½ì´ë©´ ë‹¤ìŒ ì§€ì—­ ì´ë™ ê°€ëŠ¥
                            if (gameState.monstersKilled >= 50 && !gameState.canMoveToNextArea) {
                                gameState.canMoveToNextArea = true;
                                console.log("50ë§ˆë¦¬ ê´´ë¬¼ì„ ëª¨ë‘ ì²˜ì¹˜í–ˆìŠµë‹ˆë‹¤! Ní‚¤ë¡œ ë‹¤ìŒ ì§€ì—­ìœ¼ë¡œ ì´ë™í•˜ì„¸ìš”!");
                            }
                        }
                    }
                });
            });

            // í”Œë ˆì´ì–´ì™€ ì½”ì¸
            coins.forEach((coin, index) => {
                if (checkCollision(player, coin) && !coin.collected) {
                    gameState.coins += coin.value;
                    coin.collected = true;
                    coins.splice(index, 1);
                }
            });

            // í”Œë ˆì´ì–´ì™€ ì•Œ
            eggs.forEach((egg, index) => {
                if (checkCollision(player, egg) && !egg.collected) {
                    egg.collected = true;
                    eggs.splice(index, 1);
                    // ì•Œ ìˆ˜ì§‘ íš¨ê³¼
                    gameState.score += 50;
                }
            });

            // í”Œë ˆì´ì–´ì™€ íŠ¹ë³„í•œ ì•Œ (ê²€ì€ ì•Œ)
            if (specialEgg && !specialEgg.collected && checkCollision(player, specialEgg)) {
                specialEgg.collected = true;
                // ê²€ì€ ì•Œ ìˆ˜ì§‘ íš¨ê³¼ - ë”°ë¼ì˜¤ëŠ” ìƒˆ ìƒì„±
                gameState.score += 200;
                gameState.coins += 10;
                createCompanionBird();
            }

            // í”Œë ˆì´ì–´ì™€ ì´
            guns.forEach((gun, index) => {
                if (checkCollision(player, gun) && !gun.collected) {
                    gun.collected = true;
                    guns.splice(index, 1);
                    // ì´ íšë“ íš¨ê³¼
                    gameState.score += 100;
                }
            });

            // í”Œë ˆì´ì–´ì™€ ì´ì•Œ ìƒì
            ammoBoxes.forEach((ammoBox, index) => {
                if (checkCollision(player, ammoBox) && !ammoBox.collected) {
                    // ì¸ë²¤í† ë¦¬ì— ì´ì•Œ ì¶”ê°€
                    const selectedBullet = gameState.bulletInventory[gameState.selectedBulletType];
                    if (selectedBullet) {
                        selectedBullet.count = Math.min(selectedBullet.maxCount, selectedBullet.count + ammoBox.ammo);
                    }
                    ammoBox.collected = true;
                    ammoBoxes.splice(index, 1);
                    // ì´ì•Œ íšë“ íš¨ê³¼
                    gameState.score += 20;
                }
            });

                         // í”Œë ˆì´ì–´ì™€ ì  (í”¼ê°€ ë‹¬ì•„ ì—†ì–´ì§€ëŠ” íš¨ê³¼)
             enemies.forEach(enemy => {
                 if (checkCollision(player, enemy) && !player.isInvincible && !gameState.playerDead) {
                     // í”¼ê°€ ë‹¬ì•„ ì—†ì–´ì§€ëŠ” íš¨ê³¼
                     player.health -= enemy.attack;
                     player.isInvincible = true;
                     player.invincibleTime = 60; // 1ì´ˆê°„ ë¬´ì 
                     
                     if (player.health <= 0) {
                         player.health = 0; // ì²´ë ¥ì„ 0ìœ¼ë¡œ ê³ ì •
                         gameState.playerDead = true;
                         gameState.gameOver = true;
                     }
                 }
             });
             
             // ë™êµ´ ì²´ë ¥ ê°ì†Œ (ì ì´ í™”ë©´ì„ ë²—ì–´ë‚  ë•Œ)
             enemies.forEach((enemy, index) => {
                 if (enemy.x + enemy.width < 0) {
                     // ë™êµ´ ì²´ë ¥ ê°ì†Œ
                     gameState.caveHealth -= 5;
                     enemies.splice(index, 1);
                     
                     // ë™êµ´ ì²´ë ¥ì´ 0 ì´í•˜ê°€ ë˜ë©´ ì°¨ì›ë¬¸ ìƒì„±
                     if (gameState.caveHealth <= 0 && !gameState.portalActive) {
                         gameState.caveHealth = 0;
                         gameState.portalActive = true;
                         gameState.portalX = canvas.width - 100; // ë™êµ´ ìœ„ì¹˜
                         gameState.portalY = 400;
                         console.log("ì°¨ì›ë¬¸ì´ ì—´ë ¸ìŠµë‹ˆë‹¤!");
                     }
                 }
             });

            // ë¬´ì  ì‹œê°„ ì—…ë°ì´íŠ¸
            if (player.isInvincible) {
                player.invincibleTime--;
                if (player.invincibleTime <= 0) {
                    player.isInvincible = false;
                }
            }

            // ë”°ë¼ì˜¤ëŠ” ìƒˆ ì—…ë°ì´íŠ¸
            if (gameState.companionBird) {
                // í”Œë ˆì´ì–´ë¥¼ ë”°ë¼ì˜¤ë„ë¡ ìœ„ì¹˜ ì¡°ì •
                const targetX = player.x - gameState.companionBird.followDistance;
                const targetY = player.y - 10;
                
                gameState.companionBird.x += (targetX - gameState.companionBird.x) * 0.1;
                gameState.companionBird.y += (targetY - gameState.companionBird.y) * 0.1;
            }

            // ë¸”ë™í™€ ì—…ë°ì´íŠ¸
            if (gameState.blackHoleActive) {
                gameState.blackHoleTime--;
                
                // ë¸”ë™í™€ì— ì ë“¤ì´ ëŒë ¤ë“¤ì–´ê°
                enemies.forEach((enemy, index) => {
                    const distance = Math.sqrt(
                        Math.pow(enemy.x - gameState.blackHoleX, 2) + 
                        Math.pow(enemy.y - gameState.blackHoleY, 2)
                    );
                    
                    if (distance < 100) {
                        // ë¸”ë™í™€ ì¤‘ì‹¬ìœ¼ë¡œ ëŒë ¤ë“¤ì–´ê°
                        enemy.x += (gameState.blackHoleX - enemy.x) * 0.05;
                        enemy.y += (gameState.blackHoleY - enemy.y) * 0.05;
                        
                        // ë¸”ë™í™€ ì¤‘ì‹¬ì— ê°€ê¹Œìš°ë©´ ì œê±°
                        if (distance < 20) {
                            enemies.splice(index, 1);
                            gameState.score += 50;
                        }
                    }
                });
                
                if (gameState.blackHoleTime <= 0) {
                    gameState.blackHoleActive = false;
                }
            }
        }

                 // ê²Œì„ ì˜¤ë²„ í•¨ìˆ˜
         function gameOver() {
             ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
             ctx.fillRect(0, 0, canvas.width, canvas.height);
             
             ctx.fillStyle = '#FF0000';
             ctx.font = '48px Arial';
             ctx.fillText('ê²Œì„ ì˜¤ë²„!', canvas.width/2 - 100, canvas.height/2);
             
             ctx.fillStyle = '#FFFFFF';
             ctx.font = '24px Arial';
             ctx.fillText(`ìµœì¢… ì ìˆ˜: ${gameState.score}`, canvas.width/2 - 80, canvas.height/2 + 50);
             ctx.fillText(`ìˆ˜ì§‘í•œ ì½”ì¸: ${gameState.coins}`, canvas.width/2 - 80, canvas.height/2 + 80);
             ctx.fillText('Rí‚¤ë¡œ ë¶€í™œí•˜ê¸°', canvas.width/2 - 80, canvas.height/2 + 110);
         }

                 // ê·¸ë¦¬ê¸° í•¨ìˆ˜ë“¤
         function drawPlayer() {
             // í”Œë ˆì´ì–´ê°€ ì£½ì—ˆìœ¼ë©´ ê·¸ë¦¬ì§€ ì•ŠìŒ
             if (gameState.playerDead) {
                 return;
             }
             
             // ë¬´ì  ìƒíƒœì¼ ë•Œ ê¹œë¹¡ì´ëŠ” íš¨ê³¼
             if (player.isInvincible && Math.floor(player.invincibleTime / 10) % 2 === 0) {
                 return; // ê¹œë¹¡ì´ëŠ” ë™ì•ˆ ê·¸ë¦¬ì§€ ì•ŠìŒ
             }
            
            // ìºë¦­í„° íƒ€ì…ì— ë”°ë¥¸ ìƒ‰ìƒ
            let bodyColor = '#8B4513';
            let faceColor = '#FFD700';
            
            switch(gameState.characterType) {
                case 'fire':
                    bodyColor = '#FF4500';
                    faceColor = '#FFD700';
                    break;
                case 'ice':
                    bodyColor = '#87CEEB';
                    faceColor = '#FFFFFF';
                    break;
                case 'wind':
                    bodyColor = '#98FB98';
                    faceColor = '#32CD32';
                    break;
            }
            
            // ëª¸ì²´
            ctx.fillStyle = bodyColor;
            ctx.fillRect(player.x, player.y, player.width, player.height);
            
            // ì–¼êµ´
            ctx.fillStyle = faceColor;
            ctx.beginPath();
            ctx.arc(player.x + player.width/2, player.y + 15, 12, 0, Math.PI * 2);
            ctx.fill();
            
            // ëˆˆ
            ctx.fillStyle = '#000000';
            ctx.beginPath();
            ctx.arc(player.x + player.width/2 - 5, player.y + 12, 2, 0, Math.PI * 2);
            ctx.arc(player.x + player.width/2 + 5, player.y + 12, 2, 0, Math.PI * 2);
            ctx.fill();
            
            // ëª¨ì (ìºë¦­í„° íƒ€ì…ì— ë”°ë¥¸ ë‹¤ë¥¸ ëª¨ì)
            let hatColor = '#8B0000'; // ê¸°ë³¸ ë¹¨ê°„ ëª¨ì
            switch(gameState.characterType) {
                case 'fire':
                    hatColor = '#FF4500'; // ë¶ˆíƒ€ëŠ” ì˜¤ë Œì§€ ëª¨ì
                    break;
                case 'ice':
                    hatColor = '#87CEEB'; // í•˜ëŠ˜ìƒ‰ ëª¨ì
                    break;
                case 'wind':
                    hatColor = '#32CD32'; // ì´ˆë¡ìƒ‰ ëª¨ì
                    break;
            }
            
            // ëª¨ì ê·¸ë¦¬ê¸° (ë‘¥ê·¼ ëª¨ì)
            ctx.fillStyle = hatColor;
            ctx.beginPath();
            ctx.arc(player.x + player.width/2, player.y + 5, 15, 0, Math.PI * 2);
            ctx.fill();
            
            // ëª¨ì í…Œë‘ë¦¬
            ctx.fillStyle = '#654321';
            ctx.fillRect(player.x + 5, player.y + 8, player.width - 10, 3);
            
            // ëª¨ì ì¥ì‹ (ìºë¦­í„° íƒ€ì…ë³„)
            switch(gameState.characterType) {
                case 'fire':
                    // ë¶ˆê½ƒ ì¥ì‹
                    ctx.fillStyle = '#FFD700';
                    ctx.beginPath();
                    ctx.arc(player.x + player.width/2, player.y + 2, 5, 0, Math.PI * 2);
                    ctx.fill();
                    break;
                case 'ice':
                    // ì–¼ìŒ ê²°ì • ì¥ì‹
                    ctx.fillStyle = '#FFFFFF';
                    ctx.beginPath();
                    ctx.arc(player.x + player.width/2, player.y + 2, 4, 0, Math.PI * 2);
                    ctx.fill();
                    break;
                case 'wind':
                    // ë°”ëŒ ì¥ì‹
                    ctx.fillStyle = '#98FB98';
                    ctx.beginPath();
                    ctx.arc(player.x + player.width/2, player.y + 2, 4, 0, Math.PI * 2);
                    ctx.fill();
                    break;
                default:
                    // ê¸°ë³¸ ë³„ ì¥ì‹
                    ctx.fillStyle = '#FFD700';
                    ctx.fillRect(player.x + player.width/2 - 2, player.y + 1, 4, 4);
                    break;
            }
            
            // ì²´ë ¥ë°”
            ctx.fillStyle = '#FF0000';
            ctx.fillRect(player.x, player.y - 10, player.width, 5);
            ctx.fillStyle = '#00FF00';
            ctx.fillRect(player.x, player.y - 10, (player.health / player.maxHealth) * player.width, 5);
        }

        function drawEnemies() {
            enemies.forEach(enemy => {
                ctx.fillStyle = enemy.frozen ? '#87CEEB' : enemy.color;
                ctx.fillRect(enemy.x, enemy.y, enemy.width, enemy.height);
                
                // ì²´ë ¥ë°”
                ctx.fillStyle = '#FF0000';
                ctx.fillRect(enemy.x, enemy.y - 10, enemy.width, 5);
                ctx.fillStyle = '#00FF00';
                ctx.fillRect(enemy.x, enemy.y - 10, (enemy.health / getMaxHealth(enemy.type)) * enemy.width, 5);
            });
        }

        function getMaxHealth(type) {
            switch(type) {
                case 'mini': return 5;
                case 'medium': return 15;
                case 'boss': return 50;
                default: return 5;
            }
        }

        function drawBullets() {
            bullets.forEach(bullet => {
                ctx.fillStyle = bullet.color;
                ctx.fillRect(bullet.x, bullet.y, bullet.width, bullet.height);
            });
        }

        function drawCoins() {
            coins.forEach(coin => {
                ctx.fillStyle = '#FFD700';
                ctx.beginPath();
                ctx.arc(coin.x + coin.width/2, coin.y + coin.height/2, coin.width/2, 0, Math.PI * 2);
                ctx.fill();
                
                ctx.fillStyle = '#000000';
                ctx.font = '12px Arial';
                ctx.fillText(coin.value, coin.x + 5, coin.y + 15);
            });
        }

        function drawEggs() {
            eggs.forEach(egg => {
                ctx.fillStyle = egg.color;
                ctx.fillRect(egg.x, egg.y, egg.width, egg.height);
                
                // ì•Œ ë¬´ëŠ¬
                ctx.fillStyle = '#FFFFFF';
                ctx.fillRect(egg.x + 5, egg.y + 10, 20, 5);
                ctx.fillRect(egg.x + 10, egg.y + 20, 10, 5);
            });

            // íŠ¹ë³„í•œ ì•Œ ê·¸ë¦¬ê¸° (ê²€ì€ ì•Œ)
            if (specialEgg && !specialEgg.collected) {
                ctx.fillStyle = specialEgg.color;
                ctx.fillRect(specialEgg.x, specialEgg.y, specialEgg.width, specialEgg.height);
                
                // ê²€ì€ ì•Œ ë¬´ëŠ¬ (ë°˜ì§ì´ëŠ” íš¨ê³¼)
                ctx.fillStyle = '#FFFFFF';
                ctx.fillRect(specialEgg.x + 5, specialEgg.y + 10, 20, 5);
                ctx.fillRect(specialEgg.x + 10, specialEgg.y + 20, 10, 5);
                
                // ê²€ì€ ì•Œ í‘œì‹œ
                ctx.fillStyle = '#FF0000';
                ctx.font = '12px Arial';
                ctx.fillText('â˜…', specialEgg.x + 10, specialEgg.y + 35);
            }
        }

        // ë”°ë¼ì˜¤ëŠ” ìƒˆ ê·¸ë¦¬ê¸°
        function drawCompanionBird() {
            if (gameState.companionBird) {
                ctx.fillStyle = gameState.companionBird.color;
                ctx.fillRect(gameState.companionBird.x, gameState.companionBird.y, 
                           gameState.companionBird.width, gameState.companionBird.height);
                
                // ìƒˆì˜ ëˆˆ
                ctx.fillStyle = '#FFFFFF';
                ctx.beginPath();
                ctx.arc(gameState.companionBird.x + 5, gameState.companionBird.y + 5, 2, 0, Math.PI * 2);
                ctx.fill();
            }
        }

                 // ë¸”ë™í™€ ê·¸ë¦¬ê¸°
         function drawBlackHole() {
             if (gameState.blackHoleActive) {
                 // ë¸”ë™í™€ ì¤‘ì‹¬
                 ctx.fillStyle = '#000000';
                 ctx.beginPath();
                 ctx.arc(gameState.blackHoleX, gameState.blackHoleY, 15, 0, Math.PI * 2);
                 ctx.fill();
                 
                 // ë¸”ë™í™€ íš¨ê³¼ (íšŒì „í•˜ëŠ” ì›)
                 ctx.strokeStyle = '#FFD700';
                 ctx.lineWidth = 2;
                 ctx.beginPath();
                 ctx.arc(gameState.blackHoleX, gameState.blackHoleY, 25, 0, Math.PI * 2);
                 ctx.stroke();
                 
                 ctx.beginPath();
                 ctx.arc(gameState.blackHoleX, gameState.blackHoleY, 35, 0, Math.PI * 2);
                 ctx.stroke();
             }
         }
         
         // ì°¨ì›ë¬¸ ê·¸ë¦¬ê¸°
         function drawPortal() {
             if (gameState.portalActive) {
                 // ì°¨ì›ë¬¸ ë°°ê²½ (ë°˜ì§ì´ëŠ” íš¨ê³¼)
                 ctx.fillStyle = `rgba(138, 43, 226, ${0.5 + Math.sin(Date.now() * 0.01) * 0.3})`;
                 ctx.fillRect(gameState.portalX, gameState.portalY, 60, 100);
                 
                 // ì°¨ì›ë¬¸ í…Œë‘ë¦¬
                 ctx.strokeStyle = '#FFD700';
                 ctx.lineWidth = 3;
                 ctx.strokeRect(gameState.portalX, gameState.portalY, 60, 100);
                 
                 // ì°¨ì›ë¬¸ ë‚´ë¶€ íš¨ê³¼
                 ctx.fillStyle = '#FFFFFF';
                 ctx.font = '16px Arial';
                 ctx.fillText('PORTAL', gameState.portalX + 5, gameState.portalY + 50);
                 ctx.fillText('Pí‚¤', gameState.portalX + 15, gameState.portalY + 70);
                 
                 // ì°¨ì›ë¬¸ ì•ì— ìˆì„ ë•Œ ì•ˆë‚´
                 if (checkPlayerInPortal()) {
                     ctx.fillStyle = '#FFFF00';
                     ctx.font = '14px Arial';
                     ctx.fillText('Pí‚¤ë¡œ ì°¨ì›ë¬¸ ì§„ì…!', gameState.portalX - 20, gameState.portalY - 10);
                 }
             }
         }

        function drawGuns() {
            guns.forEach(gun => {
                // ì´ ëª¸ì²´
                ctx.fillStyle = gun.color;
                ctx.fillRect(gun.x, gun.y, gun.width, gun.height);
                
                // ì´êµ¬
                ctx.fillStyle = '#000000';
                ctx.fillRect(gun.x + gun.width, gun.y + 5, 5, 5);
                
                // ì´ ì†ì¡ì´
                ctx.fillStyle = '#654321';
                ctx.fillRect(gun.x - 5, gun.y + 5, 5, 10);
            });
        }

        function drawAmmoBoxes() {
            ammoBoxes.forEach(ammoBox => {
                // ì´ì•Œ ìƒì
                ctx.fillStyle = ammoBox.color;
                ctx.fillRect(ammoBox.x, ammoBox.y, ammoBox.width, ammoBox.height);
                
                // ì´ì•Œ í‘œì‹œ
                ctx.fillStyle = '#000000';
                ctx.font = '12px Arial';
                ctx.fillText('AMMO', ammoBox.x + 2, ammoBox.y + 12);
                ctx.fillText(ammoBox.ammo, ammoBox.x + 8, ammoBox.y + 25);
            });
        }

        function drawWorld() {
            if (gameState.shopInside) {
                // ìƒì  ë‚´ë¶€
                drawShopInside();
            } else {
                // ê²Œì„ ì›”ë“œ
                drawGameWorld();
            }
        }

        function drawGameWorld() {
            // í•˜ëŠ˜
            ctx.fillStyle = '#87CEEB';
            ctx.fillRect(0, 0, canvas.width, 300);
            
            // êµ¬ë¦„ë“¤
            clouds.forEach((cloud, index) => {
                ctx.fillStyle = cloud.color;
                
                // êµ¬ë¦„ íƒ€ì…ì— ë”°ë¥¸ ë‹¤ì–‘í•œ ëª¨ì–‘ ê·¸ë¦¬ê¸°
                switch(cloud.type) {
                    case 'fluffy':
                        // ë¶€ë“œëŸ½ê³  í‘¹ì‹ í•œ êµ¬ë¦„
                        ctx.beginPath();
                        ctx.arc(cloud.x + 20, cloud.y + 15, 25 * cloud.baseSize, 0, Math.PI * 2);
                        ctx.arc(cloud.x + 45, cloud.y + 10, 30 * cloud.baseSize, 0, Math.PI * 2);
                        ctx.arc(cloud.x + 70, cloud.y + 15, 25 * cloud.baseSize, 0, Math.PI * 2);
                        ctx.arc(cloud.x + 90, cloud.y + 20, 20 * cloud.baseSize, 0, Math.PI * 2);
                        ctx.arc(cloud.x + 35, cloud.y + 25, 20 * cloud.baseSize, 0, Math.PI * 2);
                        ctx.fill();
                        break;
                        
                    case 'wispy':
                        // ì–‡ê³  ê°€ë²¼ìš´ êµ¬ë¦„
                        ctx.beginPath();
                        ctx.arc(cloud.x + 30, cloud.y + 15, 20 * cloud.baseSize, 0, Math.PI * 2);
                        ctx.arc(cloud.x + 60, cloud.y + 12, 18 * cloud.baseSize, 0, Math.PI * 2);
                        ctx.arc(cloud.x + 85, cloud.y + 18, 15 * cloud.baseSize, 0, Math.PI * 2);
                        ctx.fill();
                        break;
                        
                    case 'puffy':
                        // ë‘¥ê¸€ë‘¥ê¸€í•œ êµ¬ë¦„
                        ctx.beginPath();
                        ctx.arc(cloud.x + 25, cloud.y + 15, 22 * cloud.baseSize, 0, Math.PI * 2);
                        ctx.arc(cloud.x + 50, cloud.y + 15, 25 * cloud.baseSize, 0, Math.PI * 2);
                        ctx.arc(cloud.x + 75, cloud.y + 15, 22 * cloud.baseSize, 0, Math.PI * 2);
                        ctx.arc(cloud.x + 40, cloud.y + 25, 18 * cloud.baseSize, 0, Math.PI * 2);
                        ctx.fill();
                        break;
                        
                    case 'stormy':
                        // í­í’êµ¬ë¦„ (ì•½ê°„ ì–´ë‘¡ê³  ë³µì¡í•œ ëª¨ì–‘)
                        ctx.beginPath();
                        ctx.arc(cloud.x + 15, cloud.y + 15, 28 * cloud.baseSize, 0, Math.PI * 2);
                        ctx.arc(cloud.x + 40, cloud.y + 10, 32 * cloud.baseSize, 0, Math.PI * 2);
                        ctx.arc(cloud.x + 65, cloud.y + 15, 28 * cloud.baseSize, 0, Math.PI * 2);
                        ctx.arc(cloud.x + 90, cloud.y + 20, 25 * cloud.baseSize, 0, Math.PI * 2);
                        ctx.arc(cloud.x + 30, cloud.y + 25, 20 * cloud.baseSize, 0, Math.PI * 2);
                        ctx.arc(cloud.x + 55, cloud.y + 30, 18 * cloud.baseSize, 0, Math.PI * 2);
                        ctx.fill();
                        break;
                        
                    case 'cotton':
                        // ì†œí„¸ê°™ì€ êµ¬ë¦„
                        ctx.beginPath();
                        ctx.arc(cloud.x + 20, cloud.y + 15, 20 * cloud.baseSize, 0, Math.PI * 2);
                        ctx.arc(cloud.x + 45, cloud.y + 12, 22 * cloud.baseSize, 0, Math.PI * 2);
                        ctx.arc(cloud.x + 70, cloud.y + 15, 20 * cloud.baseSize, 0, Math.PI * 2);
                        ctx.arc(cloud.x + 35, cloud.y + 22, 18 * cloud.baseSize, 0, Math.PI * 2);
                        ctx.fill();
                        break;
                        
                    default:
                        // ê¸°ë³¸ êµ¬ë¦„
                        ctx.beginPath();
                        ctx.arc(cloud.x + 30, cloud.y + 15, 30 * cloud.baseSize, 0, Math.PI * 2);
                        ctx.arc(cloud.x + 60, cloud.y + 15, 25 * cloud.baseSize, 0, Math.PI * 2);
                        ctx.arc(cloud.x + 90, cloud.y + 15, 30 * cloud.baseSize, 0, Math.PI * 2);
                        ctx.fill();
                }
            });
            
            // ì‚¬ë‹¤ë¦¬ë“¤
            ladders.forEach(ladder => {
                ctx.fillStyle = ladder.color;
                ctx.fillRect(ladder.x, ladder.y, ladder.width, ladder.height);
                
                // ì‚¬ë‹¤ë¦¬ ê°€ë¡œëŒ€
                for (let i = 0; i < ladder.height; i += 15) {
                    ctx.fillStyle = '#654321';
                    ctx.fillRect(ladder.x - 5, ladder.y + i, ladder.width + 10, 3);
                }
            });
            
            // ë•…
            ctx.fillStyle = '#8B4513';
            ctx.fillRect(0, 500, canvas.width, 100);
            
                         // ë™êµ´ (ì  ìƒì„± ìœ„ì¹˜)
             ctx.fillStyle = '#2F4F4F';
             ctx.fillRect(canvas.width - 100, 400, 100, 100);
             
             // ë™êµ´ ì…êµ¬
             ctx.fillStyle = '#000000';
             ctx.fillRect(canvas.width - 80, 420, 60, 60);
             
             // ë™êµ´ ì²´ë ¥ë°”
             ctx.fillStyle = '#FF0000';
             ctx.fillRect(canvas.width - 100, 390, 100, 10);
             ctx.fillStyle = '#00FF00';
             ctx.fillRect(canvas.width - 100, 390, (gameState.caveHealth / 100) * 100, 10);
             
             // ë™êµ´ ì²´ë ¥ í…ìŠ¤íŠ¸
             ctx.fillStyle = '#FFFFFF';
             ctx.font = '12px Arial';
             ctx.fillText(`ë™êµ´: ${gameState.caveHealth}`, canvas.width - 90, 385);
            
            // ë™êµ´ ìœ„ í”Œë«í¼
            ctx.fillStyle = '#8B4513';
            ctx.fillRect(canvas.width - 100, 380, 100, 20);
            
            // ìƒì  (í”Œë ˆì´ì–´ ì‹œì‘ ìœ„ì¹˜ ë’¤)
            ctx.fillStyle = '#FFD700';
            ctx.fillRect(50, 400, 80, 100);
            
            // ìƒì  ì§€ë¶•
            ctx.fillStyle = '#8B0000';
            ctx.fillRect(45, 380, 90, 20);
            
            // ìƒì  ë¬¸
            ctx.fillStyle = '#654321';
            ctx.fillRect(70, 450, 20, 50);
            
            // ìƒì  ê°„íŒ
            ctx.fillStyle = '#FF0000';
            ctx.font = '16px Arial';
            ctx.fillText('SHOP', 60, 395);
            
            // ìƒì  ì• í‘œì‹œ
            if (checkPlayerInShop()) {
                ctx.fillStyle = '#FFFF00';
                ctx.font = '14px Arial';
                ctx.fillText('Sí‚¤ë¡œ ë“¤ì–´ê°€ê¸°', 40, 520);
            }
            
            // ë‚˜ë¬´ë“¤
            ctx.fillStyle = '#228B22';
            for (let i = 0; i < 3; i++) {
                ctx.fillRect(200 + i * 300, 400, 40, 100);
                ctx.beginPath();
                ctx.arc(220 + i * 300, 380, 50, 0, Math.PI * 2);
                ctx.fill();
            }
            
            // ê½ƒë“¤
            ctx.fillStyle = '#FF69B4';
            for (let i = 0; i < 5; i++) {
                ctx.beginPath();
                ctx.arc(100 + i * 150, 480, 8, 0, Math.PI * 2);
                ctx.fill();
            }
        }

        function drawShopInside() {
            // ìƒì  ë‚´ë¶€ ë°°ê²½
            ctx.fillStyle = '#8B4513';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // ë°”ë‹¥
            ctx.fillStyle = '#654321';
            ctx.fillRect(0, 500, canvas.width, 100);
            
            // ë²½
            ctx.fillStyle = '#DEB887';
            ctx.fillRect(0, 0, canvas.width, 500);
            
            // ì²œì¥
            ctx.fillStyle = '#8B4513';
            ctx.fillRect(0, 0, canvas.width, 50);
            
            // ìƒì  ë‚´ë¶€ ì¥ì‹
            ctx.fillStyle = '#FFD700';
            ctx.fillRect(200, 100, 600, 300);
            
            // ìƒì  ì¹´ìš´í„°
            ctx.fillStyle = '#8B4513';
            ctx.fillRect(200, 350, 600, 50);
            
            // ìƒì  ì£¼ì¸
            ctx.fillStyle = '#8B4513';
            ctx.fillRect(800, 300, 40, 60);
            
            // ìƒì  ì£¼ì¸ ì–¼êµ´
            ctx.fillStyle = '#FFD700';
            ctx.beginPath();
            ctx.arc(820, 320, 12, 0, Math.PI * 2);
            ctx.fill();
            
            // ìƒì  ì£¼ì¸ ëˆˆ
            ctx.fillStyle = '#000000';
            ctx.beginPath();
            ctx.arc(815, 318, 2, 0, Math.PI * 2);
            ctx.arc(825, 318, 2, 0, Math.PI * 2);
            ctx.fill();
            
            // ìƒì  ë‚´ë¶€ í…ìŠ¤íŠ¸
            ctx.fillStyle = '#000000';
            ctx.font = '24px Arial';
            ctx.fillText('ğŸª ë°•ë¯¼êµ ìƒì ', 400, 80);
            
            ctx.font = '18px Arial';
            ctx.fillText('ì´ì•Œ 20ê°œ - 1ì½”ì¸', 220, 150);
            ctx.fillText('ìºë¦­í„° ë³€ê²½ - 5ì½”ì¸', 220, 180);
            ctx.fillText('Sí‚¤ë¡œ ë‚˜ê°€ê¸°', 220, 210);
            
            // ìƒì  ë‚´ë¶€ ì¡°ì‘ë²•
            ctx.fillStyle = '#000000';
            ctx.font = '16px Arial';
            ctx.fillText('B: ì´ì•Œ êµ¬ë§¤', 220, 250);
            ctx.fillText('1,2,3: ìºë¦­í„° ë³€ê²½', 220, 280);
        }

        function drawUI() {
            ctx.fillStyle = '#000000';
            ctx.font = '20px Arial';
            ctx.fillText(`ì ìˆ˜: ${gameState.score}`, 10, 30);
            ctx.fillText(`ì½”ì¸: ${gameState.coins}`, 10, 60);
            ctx.fillText(`ì²´ë ¥: ${player.health}`, 10, 90);
            // í˜„ì¬ ì„ íƒëœ ì´ì•Œ ì •ë³´
            const selectedBullet = gameState.bulletInventory[gameState.selectedBulletType];
            ctx.fillText(`ì´ì•Œ: ${selectedBullet ? selectedBullet.name : 'ì—†ìŒ'}`, 10, 120);
            ctx.fillText(`ë³´ìœ : ${selectedBullet ? selectedBullet.count : 0}`, 10, 140);
            ctx.fillText(`ë ˆë²¨: ${gameState.level}`, 10, 150);
            ctx.fillText(`ì„¸ê³„: ${gameState.world}`, 10, 180);
            ctx.fillText(`ì§€ì—­: ${gameState.currentArea}`, 10, 210);
            ctx.fillText(`ê´´ë¬¼ ì‚¬ëƒ¥: ${gameState.monstersKilled}/50`, 10, 240);
            
            // ìƒì  UI
            if (gameState.shopOpen) {
                ctx.fillStyle = 'rgba(0, 0, 0, 0.8)';
                ctx.fillRect(300, 100, 400, 400);
                
                ctx.fillStyle = '#FFFFFF';
                ctx.font = '24px Arial';
                ctx.fillText('ğŸª ìƒì ', 450, 140);
                
                ctx.font = '18px Arial';
                ctx.fillText('ì´ì•Œ 20ê°œ - 1ì½”ì¸', 320, 200);
                ctx.fillText('Bí‚¤ë¡œ êµ¬ë§¤', 320, 230);
                ctx.fillText(`ë³´ìœ  ì½”ì¸: ${gameState.coins}`, 320, 260);
                
                // ìºë¦­í„° ë³€ê²½ ì˜µì…˜
                ctx.fillText('ìºë¦­í„° ë³€ê²½ (5ì½”ì¸):', 320, 300);
                ctx.fillText('1: ë¶ˆ ìºë¦­í„° (ì²´ë ¥+20)', 320, 330);
                ctx.fillText('2: ì–¼ìŒ ìºë¦­í„° (ì´ì•Œ+10)', 320, 360);
                ctx.fillText('3: ë°”ëŒ ìºë¦­í„° (ì í”„+5)', 320, 390);
                ctx.fillText('Sí‚¤ë¡œ ìƒì  ë‹«ê¸°', 320, 420);
            }
            
                         // ì¡°ì‘ë²• ì•ˆë‚´
             ctx.fillStyle = '#000000';
             ctx.font = '14px Arial';
             ctx.fillText('S: ìƒì  UI / ìƒì  ë“¤ì–´ê°€ê¸°/ë‚˜ê°€ê¸°', 10, 270);
             ctx.fillText('B: ì´ì•Œ êµ¬ë§¤ (ìƒì ì—ì„œ) / ë¸”ë™í™€ ì†Œí™˜', 10, 290);
             ctx.fillText('1,2,3: ìºë¦­í„° ë³€ê²½ (ìƒì ì—ì„œ)', 10, 310);
             ctx.fillText('â†‘â†“: ì‚¬ë‹¤ë¦¬ ì˜¤ë¥´ë‚´ë¦¬ê¸°', 10, 330);
             ctx.fillText('ì í”„ë ¥ ì¦ê°€! êµ¬ë¦„ì„ ë°Ÿì„ ìˆ˜ ìˆì–´ìš”!', 10, 350);
             ctx.fillText('R: ë¶€í™œ (ì£½ì—ˆì„ ë•Œ)', 10, 370);
             ctx.fillText('P: ì°¨ì›ë¬¸ ì§„ì… (ì°¨ì›ë¬¸ ì—´ë ¸ì„ ë•Œ)', 10, 390);
             ctx.fillText('N: ë‹¤ìŒ ì§€ì—­ ì´ë™ (ê´´ë¬¼ 50ë§ˆë¦¬ ì²˜ì¹˜ í›„)', 10, 410);
             ctx.fillText('I: ì´ì•Œ ì¸ë²¤í† ë¦¬ ì—´ê¸°/ë‹«ê¸°', 10, 430);
             if (gameState.companionBird) {
                 ctx.fillText('ê²€ì€ ì•Œ ìˆ˜ì§‘ ì™„ë£Œ! ë”°ë¼ì˜¤ëŠ” ìƒˆ í™œì„±í™”!', 10, 450);
             }
             if (gameState.shopInside) {
                 ctx.fillText('ìƒì  ë‚´ë¶€ - Sí‚¤ë¡œ ë‚˜ê°€ê¸°', 10, 470);
             }
             
             // í”Œë ˆì´ì–´ê°€ ì£½ì—ˆì„ ë•Œ ë¶€í™œ ì•ˆë‚´
             if (gameState.playerDead) {
                 ctx.fillStyle = '#FF0000';
                 ctx.font = '20px Arial';
                 ctx.fillText('í”Œë ˆì´ì–´ê°€ ì£½ì—ˆìŠµë‹ˆë‹¤! Rí‚¤ë¡œ ë¶€í™œí•˜ì„¸ìš”!', 300, 200);
             }
             
             // ì°¨ì›ë¬¸ ì•ˆë‚´
             if (gameState.portalActive) {
                 ctx.fillStyle = '#8A2BE2';
                 ctx.font = '18px Arial';
                 ctx.fillText('ì°¨ì›ë¬¸ì´ ì—´ë ¸ìŠµë‹ˆë‹¤! Pí‚¤ë¡œ ìƒˆë¡œìš´ ì„¸ê³„ë¡œ ì´ë™í•˜ì„¸ìš”!', 200, 250);
             }
             
             // ë‹¤ìŒ ì§€ì—­ ì´ë™ ì•ˆë‚´
             if (gameState.canMoveToNextArea) {
                 ctx.fillStyle = '#00FF00';
                 ctx.font = '20px Arial';
                 ctx.fillText('ğŸ‰ 50ë§ˆë¦¬ ê´´ë¬¼ ì²˜ì¹˜ ì™„ë£Œ! Ní‚¤ë¡œ ë‹¤ìŒ ì§€ì—­ìœ¼ë¡œ ì´ë™í•˜ì„¸ìš”!', 200, 280);
             }
             
             // ì¸ë²¤í† ë¦¬ UI
             if (gameState.inventoryOpen) {
                 ctx.fillStyle = 'rgba(0, 0, 0, 0.9)';
                 ctx.fillRect(200, 50, 600, 500);
                 
                 ctx.fillStyle = '#FFFFFF';
                 ctx.font = '24px Arial';
                 ctx.fillText('ğŸ’ ì´ì•Œ ì¸ë²¤í† ë¦¬', 450, 90);
                 
                 ctx.font = '16px Arial';
                 let yPos = 130;
                 
                 Object.keys(gameState.bulletInventory).forEach((type, index) => {
                     const bullet = gameState.bulletInventory[type];
                     const isSelected = gameState.selectedBulletType === type;
                     
                     // ì„ íƒëœ ì´ì•Œ ê°•ì¡°
                     if (isSelected) {
                         ctx.fillStyle = '#FFFF00';
                         ctx.fillRect(220, yPos - 15, 560, 25);
                     }
                     
                     ctx.fillStyle = isSelected ? '#000000' : '#FFFFFF';
                     ctx.fillText(`${index + 1}: ${bullet.name}`, 240, yPos);
                     ctx.fillText(`ë³´ìœ : ${bullet.count}/${bullet.maxCount}`, 400, yPos);
                     ctx.fillText(`ë°ë¯¸ì§€: ${bullet.damage}`, 520, yPos);
                     
                     // ì´ì•Œ ìƒ‰ìƒ í‘œì‹œ
                     ctx.fillStyle = bullet.color;
                     ctx.fillRect(650, yPos - 10, 20, 10);
                     
                     yPos += 30;
                 });
                 
                 ctx.fillStyle = '#FFFFFF';
                 ctx.font = '14px Arial';
                 ctx.fillText('Ií‚¤ë¡œ ì¸ë²¤í† ë¦¬ ë‹«ê¸°', 450, 520);
                 ctx.fillText('1-5í‚¤ë¡œ ì´ì•Œ íƒ€ì… ì„ íƒ', 450, 540);
             }
        }

                 // ë©”ì¸ ê²Œì„ ë£¨í”„
         function gameLoop() {
             // í™”ë©´ í´ë¦¬ì–´
             ctx.clearRect(0, 0, canvas.width, canvas.height);
             
             // ê²Œì„ ì—…ë°ì´íŠ¸
             updateGame();
             
             // ê·¸ë¦¬ê¸°
             drawWorld();
             if (!gameState.shopInside) {
                 // ê²Œì„ ì›”ë“œì—ì„œë§Œ ê·¸ë¦¬ê¸°
                 drawEnemies();
                 drawBullets();
                 drawCoins();
                 drawEggs();
                 drawGuns();
                 drawAmmoBoxes();
                 drawCompanionBird();
                 drawBlackHole();
                 drawPortal();
             }
             drawPlayer();
             drawUI();
             
             // ê²Œì„ ì˜¤ë²„ í™”ë©´ í‘œì‹œ
             if (gameState.gameOver) {
                 gameOver();
             }
             
             requestAnimationFrame(gameLoop);
         }

        // ì  ìƒì„± íƒ€ì´ë¨¸
        setInterval(() => {
            if (Math.random() < 0.3) {
                createEnemy();
            }
        }, 2000);

        // ì•Œ ìƒì„± íƒ€ì´ë¨¸
        setInterval(() => {
            if (Math.random() < 0.1) {
                createEgg();
            }
        }, 5000);

        // ì´ ìƒì„± íƒ€ì´ë¨¸
        setInterval(() => {
            if (Math.random() < 0.05) {
                createGun();
            }
        }, 8000);

        // ì´ì•Œ ìƒì ìƒì„± íƒ€ì´ë¨¸
        setInterval(() => {
            if (Math.random() < 0.08) {
                createAmmoBox();
            }
        }, 6000);

        // êµ¬ë¦„ ìƒì„±
        createClouds();

        // ê²Œì„ ì‹œì‘
        console.log("ë°•ë¯¼êµì˜ ë¬´í•œí•œ ì•Œê³¼ ì„¸ê³„ ê²Œì„ì´ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤!");
        gameLoop();
    </script>
</body>
</html> 